{
  pkgs,
  lib,
  ...
}:
let
  customKernel = pkgs.linuxKernel.packagesFor (
    pkgs.linuxKernel.kernels.linux_6_12.override {
      kernelPatches = [
        {
          name = "Patch netdev labels like OpenWRT";
          patch = ./bpi-r3-dts.patch;
        }
        {
          name = "Patch phylink driver using Frank-w kernel";
          patch = ./net-phylink.patch;
        }
      ];
      autoModules = false;
      ignoreConfigErrors = true;
      structuredExtraConfig =
        with lib.kernel;
        {
          # Add drivers for 10Gtek SFP-2.5G-T PHY (YT8821)
          MOTORCOMM_PHY = yes;
        }
        // {
          ###################################
          # Frank-w linux-6.12-bpi-r3 config
          ###################################
          "32BIT" = yes;
          "64BIT_TIME" = yes;
          ADVISE_SYSCALLS = yes;
          AEABI = yes;
          AF_UNIX_OOB = yes;
          AIO = yes;
          ALLOW_DEV_COREDUMP = yes;
          ANON_INODES = yes;
          ARCH_BINFMT_ELF_STATE = yes;
          ARCH_FLATMEM_ENABLE = yes;
          ARM64_SW_TTBR0_PAN = yes;
          ARM_CPU_TOPOLOGY = yes;
          ARM_DMA_MEM_BUFFERABLE = yes;
          ARM_GIC_MAX_NR = freeform "1";
          ATAGS_PROC = yes;
          ATA_BMDMA = yes;
          ATA_SFF = yes;
          ATM_BR2684_IPFILTER = yes;
          ATM_CLIP_NO_ICMP = yes;
          BASE_FULL = yes;
          BASE_SMALL = no;
          BCMA_POSSIBLE = yes;
          BINARY_PRINTF = yes;
          BINFMT_ELF = yes;
          BINFMT_SCRIPT = yes;
          BITREVERSE = yes;
          BLK_DEV = yes;
          BLK_DEV_INITRD = yes;
          BLK_DEV_LOOP_MIN_COUNT = freeform "8";
          BLOCK = yes;
          BOOKE_WDT_DEFAULT_TIMEOUT = freeform "3";
          BOOT_RAW = yes;
          BPF = yes;
          BPF_JIT = yes;
          BPF_JIT_DEFAULT_ON = yes;
          BPF_SYSCALL = yes;
          BPF_UNPRIV_DEFAULT_OFF = yes;
          BQL = yes;
          BRANCH_PROFILE_NONE = yes;
          BRIDGE = yes;
          BRIDGE_IGMP_SNOOPING = yes;
          BRIDGE_VLAN_FILTERING = yes;
          BROKEN_ON_SMP = yes;
          BT_BNEP_MC_FILTER = yes;
          BT_BNEP_PROTO_FILTER = yes;
          BT_HCIUART_BCSP = yes;
          BT_HCIUART_H4 = yes;
          BT_RFCOMM_TTY = yes;
          BUG = yes;
          BUILDTIME_EXTABLE_SORT = yes;
          BUILDTIME_TABLE_SORT = yes;
          # BUILD_SALT = freeform "";
          CACHE_L2X0_PMU = yes;
          CARDBUS = yes;
          CC_CAN_LINK = yes;
          CC_OPTIMIZE_FOR_PERFORMANCE = yes;
          CIFS = module;
          CIFS_ALLOW_INSECURE_LEGACY = yes;
          CIFS_POSIX = yes;
          CIFS_XATTR = yes;
          CIFS_FSCACHE = yes;
          CLS_U32_MARK = yes;
          # CMDLINE = freeform "";
          COMPACTION = yes;
          #CONSOLE_LOGLEVEL_DEFAULT = freeform "7";
          CONSOLE_LOGLEVEL_QUIET = freeform "4";
          CONSTRUCTORS = yes;
          CPU_LITTLE_ENDIAN = yes;
          CPU_SW_DOMAIN_PAN = yes;
          CRAMFS_BLOCKDEV = yes;
          CRC32 = yes;
          CRC32_SARWATE = yes;
          CROSS_COMPILE = freeform "";
          CRYPTO = yes;
          CRYPTO_ACOMP2 = yes;
          CRYPTO_AEAD = yes;
          CRYPTO_AEAD2 = yes;
          CRYPTO_AES = yes;
          CRYPTO_AKCIPHER = yes;
          CRYPTO_AKCIPHER2 = yes;
          CRYPTO_ALGAPI = yes;
          CRYPTO_ALGAPI2 = yes;
          CRYPTO_CCM = yes;
          CRYPTO_CTR = yes;
          CRYPTO_GCM = yes;
          CRYPTO_GF128MUL = yes;
          CRYPTO_GHASH = yes;
          CRYPTO_HASH = yes;
          CRYPTO_HASH2 = yes;
          CRYPTO_KPP = yes;
          CRYPTO_KPP2 = yes;
          CRYPTO_LIB_AES = yes;
          CRYPTO_LIB_ARC4 = yes;
          CRYPTO_LIB_POLY1305_RSIZE = freeform "9";
          CRYPTO_MANAGER = yes;
          CRYPTO_MANAGER2 = yes;
          CRYPTO_MANAGER_DISABLE_TESTS = yes;
          CRYPTO_NULL = yes;
          CRYPTO_NULL2 = yes;
          CRYPTO_PCRYPT = yes;
          CRYPTO_SKCIPHER = yes;
          CRYPTO_SKCIPHER2 = yes;
          DEBUG_FS = yes;
          DEBUG_FS_ALLOW_ALL = yes;
          DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT = yes;
          DEBUG_KERNEL = yes;
          DEFAULT_CUBIC = yes;
          DEFAULT_DEADLINE = yes;
          DEFAULT_FQ_CODEL = yes;
          DEFAULT_HOSTNAME = freeform "(none)";
          DEFAULT_HUNG_TASK_TIMEOUT = freeform "120";
          # DEFAULT_INIT = freeform "";
          DEFAULT_MMAP_MIN_ADDR = lib.mkForce (freeform "4096");
          DEFAULT_NET_SCH = freeform "fq_codel";
          # DEFAULT_SECURITY = freeform "";
          DEFAULT_SECURITY_DAC = yes;
          DEFAULT_TCP_CONG = freeform "cubic";
          DEFLIST = freeform "/lib/modules/$UNAME_RELEASE/.config";
          DEVPORT = yes;
          DMA_COHERENT_POOL = yes;
          DMA_DECLARE_COHERENT = yes;
          DMA_NONCOHERENT_MMAP = yes;
          DOUBLEFAULT = yes;
          DQL = yes;
          DUMMY_CONSOLE_COLUMNS = freeform "80";
          DUMMY_CONSOLE_ROWS = freeform "25";
          DVB_MAX_ADAPTERS = freeform "16";
          DYNAMIC_DEBUG_CORE = yes;
          EFI_PARTITION = yes;
          ELFCORE = yes;
          EMBEDDED = yes;
          ENABLE_WARN_DEPRECATED = yes;
          EPOLL = yes;
          ETHERNET = yes;
          ETHTOOL_NETLINK = yes;
          EVENTFD = yes;
          EXPERT = yes;
          EXPORTFS = yes;
          EXT2_FS_XATTR = yes;
          EXT4_USE_FOR_EXT2 = yes;
          EXTRA_TARGETS = freeform "";
          F2FS_FS_XATTR = yes;
          F2FS_STAT_FS = yes;
          FAT_DEFAULT_CODEPAGE = freeform "437";
          FAT_DEFAULT_IOCHARSET = freeform "iso8859-1";
          FB_NOTIFY = yes;
          FIB_RULES = yes;
          FILE_LOCKING = yes;
          FLATMEM = yes;
          FLATMEM_MANUAL = yes;
          FLAT_NODE_MEM_MAP = yes;
          FORCE_MAX_ZONEORDER = freeform "11";
          FORTIFY_SOURCE = yes;
          FRAME_WARN = freeform "1024";
          FSNOTIFY = yes;
          FUTEX = yes;
          FUTEX_PI = yes;
          FW_LOADER = yes;
          FW_LOADER_USER_HELPER = yes;
          FW_LOADER_USER_HELPER_FALLBACK = lib.mkForce yes;
          GACT_PROB = yes;
          GENERIC_CALIBRATE_DELAY = yes;
          GENERIC_HWEIGHT = yes;
          GENERIC_IRQ_IPI = yes;
          GENERIC_IRQ_PROBE = yes;
          GENERIC_NET_UTILS = yes;
          GENERIC_PTDUMP = yes;
          GENERIC_VDSO_TIME_NS = yes;
          GPIOLIB_FASTPATH_LIMIT = freeform "512";
          GPIO_SYSFS = yes;
          HARDENED_USERCOPY = yes;
          HARDEN_BRANCH_HISTORY = yes;
          HARDEN_EL2_VECTORS = yes;
          HIGH_RES_TIMERS = yes;
          HPET_MMAP_DEFAULT = yes;
          HW_PERF_EVENTS = yes;
          HW_RANDOM_TPM = yes;
          HZ = freeform "100";
          HZ_100 = yes;
          IIO_CONSUMERS_PER_TRIGGER = freeform "2";
          INET = yes;
          INIT_ENV_ARG_LIMIT = freeform "32";
          INIT_STACK_NONE = yes;
          INOTIFY_USER = yes;
          INPUT_MISC = yes;
          IO_STRICT_DEVMEM = yes;
          IO_WQ = yes;
          IPV6_NDISC_NODETYPE = yes;
          IPW2100_MONITOR = yes;
          IPW2200_MONITOR = yes;
          IP_ADVANCED_ROUTER = yes;
          IP_MROUTE_MULTIPLE_TABLES = yes;
          IP_MULTICAST = yes;
          IP_MULTIPLE_TABLES = yes;
          IP_ROUTE_MULTIPATH = yes;
          IP_ROUTE_VERBOSE = yes;
          IP_VS_MH_TAB_INDEX = freeform "10";
          ISDN = yes;
          JFFS2_CMODE_PRIORITY = yes;
          JFFS2_COMPRESSION_OPTIONS = yes;
          JFFS2_FS = yes;
          JFFS2_FS_DEBUG = freeform "0";
          JFFS2_FS_WRITEBUFFER = yes;
          JFFS2_FS_XATTR = yes;
          JFFS2_LZMA = yes;
          JFFS2_RTIME = yes;
          JFFS2_SUMMARY = yes;
          JOLIET = yes;
          KALLSYMS_BASE_RELATIVE = yes;
          KASAN_STACK = yes;
          KERNEL_MODE_NEON = yes;
          KERNEL_XZ = yes;
          KERNFS = yes;
          KUSER_HELPERS = yes;
          LBDAF = yes;
          LDISC_AUTOLOAD = yes;
          LD_DEAD_CODE_DATA_ELIMINATION = yes;
          LEDS_BRIGHTNESS_HW_CHANGED = yes;
          LEDS_CLASS = yes;
          LEDS_CLASS_MULTICOLOR = yes;
          LEDS_TRIGGERS = yes;
          LEDS_TRIGGER_DEFAULT_ON = yes;
          LEDS_TRIGGER_HEARTBEAT = yes;
          LEDS_TRIGGER_NETDEV = yes;
          LEDS_TRIGGER_TIMER = yes;
          LEDS_GPIO = yes;
          LINEAR_RANGES = yes;
          LLC = yes;
          LOCKDEP_SUPPORT = yes;
          LOCKD_V4 = yes;
          LOG_BUF_SHIFT = freeform "17";
          LOG_CPU_MAX_BUF_SHIFT = freeform "12";
          LSM = freeform "lockdown,yama,loadpin,safesetid,integrity";
          LSM_MMAP_MIN_ADDR = freeform "65536";
          LTO_NONE = yes;
          LZMA_COMPRESS = yes;
          LZMA_DECOMPRESS = yes;
          MAC80211_STA_HASH_MAX_SIZE = freeform "0";
          MAGIC_SYSRQ_DEFAULT_ENABLE = freeform "0x1";
          MAGIC_SYSRQ_SERIAL_SEQUENCE = freeform "";
          MAY_USE_DEVLINK = yes;
          MEMBARRIER = yes;
          #MESSAGE_LOGLEVEL_DEFAULT = freeform "4";
          MII = yes;
          MISC_FILESYSTEMS = yes;
          MITIGATE_SPECTRE_BRANCH_HISTORY = yes;
          MMC_BLOCK_BOUNCE = yes;
          MMC_BLOCK_MINORS = lib.mkForce (freeform "8");
          MMU = yes;
          MMU_GATHER_RCU_TABLE_FREE = yes;
          MMU_GATHER_TABLE_FREE = yes;
          MODPROBE_PATH = freeform "/sbin/modprobe";
          MODULES = yes;
          MODULE_COMPRESS_NONE = yes;
          MODULE_STRIPPED = yes;
          MODULE_UNLOAD = yes;
          MSDOS_PARTITION = yes;
          MTD = yes;
          MTD_BLKDEVS = yes;
          MTD_BLOCK = yes;
          MTD_CFI = yes;
          MTD_CFI_AMDSTD = yes;
          MTD_CFI_I1 = yes;
          MTD_CFI_I2 = yes;
          MTD_CFI_INTELEXT = yes;
          MTD_CFI_NOSWAP = yes;
          MTD_CFI_UTIL = yes;
          MTD_COMPLEX_MAPPINGS = yes;
          MTD_GEN_PROBE = yes;
          MTD_MAP_BANK_WIDTH_1 = yes;
          MTD_MAP_BANK_WIDTH_2 = yes;
          MTD_MAP_BANK_WIDTH_4 = yes;
          MTD_NAND_DENALI_SCRATCH_REG_ADDR = freeform "0xff108018";
          MTD_NAND_IDS = yes;
          MTD_OF_PARTS = yes;
          MTD_PHYSMAP_OF = yes;
          MTD_REDBOOT_DIRECTORY_BLOCK = freeform "-1";
          MTD_ROOTFS_ROOT_DEV = yes;
          MTD_SPI_NOR_SWP_DISABLE_ON_VOLATILE = yes;
          MTD_SPI_NOR_USE_4K_SECTORS_LIMIT = freeform "4096";
          MTD_SPLIT = yes;
          MTD_SPLIT_FIRMWARE_NAME = freeform "firmware";
          MTD_SPLIT_SQUASHFS_ROOT = yes;
          MTD_SPLIT_SUPPORT = yes;
          MULTIUSER = yes;
          NET = yes;
          NETDEVICES = yes;
          NETWORK_FILESYSTEMS = yes;
          NET_CADENCE = yes;
          NET_CLS = yes;
          NET_CLS_IND = yes;
          NET_CORE = yes;
          NET_EMATCH_STACK = freeform "32";
          NET_IPGRE_BROADCAST = yes;
          NET_RX_BUSY_POLL = yes;
          NET_SCHED = yes;
          NET_SCH_DEFAULT = yes;
          NET_SCH_FIFO = yes;
          NET_SCH_FQ_CODEL = yes;
          NET_SOCK_MSG = yes;
          NET_VENDOR_3COM = yes;
          NET_VENDOR_8390 = yes;
          NET_VENDOR_ADAPTEC = yes;
          NET_VENDOR_AGERE = yes;
          NET_VENDOR_ALACRITECH = yes;
          NET_VENDOR_ALTEON = yes;
          NET_VENDOR_AMAZON = yes;
          NET_VENDOR_AMD = yes;
          NET_VENDOR_AQUANTIA = yes;
          NET_VENDOR_ARC = yes;
          NET_VENDOR_ATHEROS = yes;
          NET_VENDOR_AURORA = yes;
          NET_VENDOR_BROADCOM = yes;
          NET_VENDOR_BROCADE = yes;
          NET_VENDOR_CADENCE = yes;
          NET_VENDOR_CAVIUM = yes;
          NET_VENDOR_CHELSIO = yes;
          NET_VENDOR_CIRRUS = yes;
          NET_VENDOR_CISCO = yes;
          NET_VENDOR_CORTINA = yes;
          NET_VENDOR_DEC = yes;
          NET_VENDOR_DLINK = yes;
          NET_VENDOR_EMULEX = yes;
          NET_VENDOR_EXAR = yes;
          NET_VENDOR_EZCHIP = yes;
          NET_VENDOR_FARADAY = yes;
          NET_VENDOR_FREESCALE = yes;
          NET_VENDOR_FUJITSU = yes;
          NET_VENDOR_GOOGLE = yes;
          NET_VENDOR_HISILICON = yes;
          NET_VENDOR_HP = yes;
          NET_VENDOR_HUAWEI = yes;
          NET_VENDOR_I825XX = yes;
          NET_VENDOR_IBM = yes;
          NET_VENDOR_INTEL = yes;
          NET_VENDOR_MARVELL = yes;
          NET_VENDOR_MELLANOX = yes;
          NET_VENDOR_MICREL = yes;
          NET_VENDOR_MICROCHIP = yes;
          NET_VENDOR_MICROSEMI = yes;
          NET_VENDOR_MYRI = yes;
          NET_VENDOR_NATSEMI = yes;
          NET_VENDOR_NETERION = yes;
          NET_VENDOR_NETRONOME = yes;
          NET_VENDOR_NI = yes;
          NET_VENDOR_NVIDIA = yes;
          NET_VENDOR_OKI = yes;
          NET_VENDOR_PACKET_ENGINES = yes;
          NET_VENDOR_PENSANDO = yes;
          NET_VENDOR_QLOGIC = yes;
          NET_VENDOR_QUALCOMM = yes;
          NET_VENDOR_RDC = yes;
          NET_VENDOR_REALTEK = yes;
          NET_VENDOR_RENESAS = yes;
          NET_VENDOR_ROCKER = yes;
          NET_VENDOR_SAMSUNG = yes;
          NET_VENDOR_SEEQ = yes;
          NET_VENDOR_SILAN = yes;
          NET_VENDOR_SIS = yes;
          NET_VENDOR_SMSC = yes;
          NET_VENDOR_SOCIONEXT = yes;
          NET_VENDOR_SOLARFLARE = yes;
          NET_VENDOR_STMICRO = yes;
          NET_VENDOR_SUN = yes;
          NET_VENDOR_SYNOPSYS = yes;
          NET_VENDOR_TEHUTI = yes;
          NET_VENDOR_TI = yes;
          NET_VENDOR_TOSHIBA = yes;
          NET_VENDOR_VIA = yes;
          NET_VENDOR_WIZNET = yes;
          NET_VENDOR_XILINX = yes;
          NET_VENDOR_XIRCOM = yes;
          NEW_LEDS = yes;
          NFSD_V3 = yes;
          NFS_COMMON = yes;
          NFS_V3 = yes;
          NF_CONNTRACK_PROCFS = yes;
          NF_NAT_MASQUERADE_IPV4 = yes;
          NF_NAT_MASQUERADE_IPV6 = yes;
          NF_TABLES_ARP = yes;
          NF_TABLES_BRIDGE = lib.mkForce module;
          NF_TABLES_INET = yes;
          NF_TABLES_IPV4 = yes;
          NF_TABLES_IPV6 = yes;
          NF_TABLES_NETDEV = yes;
          NLATTR = yes;
          NLS_DEFAULT = lib.mkForce (freeform "iso8859-1");
          NMI_LOG_BUF_SHIFT = freeform "13";
          OF_RESERVED_MEM = yes;
          OPTIMIZE_INLINING = yes;
          OVERLAY_FS = yes;
          OVERLAY_FS_REDIRECT_ALWAYS_FOLLOW = yes;
          OVERLAY_FS_XINO_AUTO = yes;
          PACKET = yes;
          PAGE_SIZE_4KB = yes;
          PANIC_ON_OOPS = yes;
          PANIC_ON_OOPS_VALUE = freeform "1";
          PARTITION_ADVANCED = yes;
          PCIE_BUS_DEFAULT = yes;
          PCI_QUIRKS = yes;
          PCI_SYSCALL = yes;
          PINCONF = yes;
          PINCTRL_SINGLE = yes;
          PINMUX = yes;
          POSIX_TIMERS = yes;
          PPC_4K_PAGES = yes;
          PPP_FILTER = yes;
          PPP_MULTILINK = yes;
          PREEMPT_NONE = yes;
          PREVENT_FIRMWARE_BUILD = yes;
          PRINTK = yes;
          PRINTK_NMI = yes;
          PRINTK_SAFE_LOG_BUF_SHIFT = freeform "13";
          PRINT_STACK_DEPTH = freeform "64";
          PROC_FS = yes;
          PROC_SYSCTL = yes;
          PSTORE_DEFAULT_KMSG_BYTES = freeform "10240";
          PWRSEQ_EMMC = yes;
          PWRSEQ_SIMPLE = yes;
          RCU_CPU_STALL_TIMEOUT = freeform "60";
          RCU_KTHREAD_PRIO = freeform "0";
          RCU_NEED_SEGCBLIST = yes;
          RCU_STALL_COMMON = yes;
          RCU_TORTURE_TEST_SLOW_INIT_DELAY = freeform "3";
          REISERFS_FS_XATTR = yes;
          RFKILL = yes;
          RTC_DRV_CMOS = yes;
          RTC_HCTOSYS = yes;
          RTC_HCTOSYS_DEVICE = freeform "rtc0";
          RTC_INTF_DEV = yes;
          RTC_INTF_PROC = yes;
          RTC_INTF_SYSFS = yes;
          RTC_LIB = yes;
          RTC_SYSTOHC = yes;
          RTC_SYSTOHC_DEVICE = freeform "rtc0";
          RT_MUTEXES = yes;
          RUNTIME_TESTING_MENU = lib.mkForce yes;
          RWSEM_GENERIC_SPINLOCK = yes;
          RXKAD = yes;
          SATA_MOBILE_LPM_POLICY = lib.mkForce (freeform "0");
          SBITMAP = yes;
          SCHED_HRTICK = yes;
          SCHED_OMIT_FRAME_POINTER = yes;
          SCSI_DMA = yes;
          SCSI_LOWLEVEL = yes;
          SCSI_MOD = yes;
          SCSI_PROC_FS = yes;
          SECTION_MISMATCH_WARN_ONLY = yes;
          SECURITY_DMESG_RESTRICT = yes;
          SECURITY_SELINUX_CHECKREQPROT_VALUE = freeform "0";
          SELECT_MEMORY_MODEL = yes;
          SERIAL_8250 = yes;
          SERIAL_8250_16550A_VARIANTS = yes;
          SERIAL_8250_CONSOLE = yes;
          SERIAL_8250_DMA = yes;
          SERIAL_8250_NR_UARTS = freeform "3";
          SERIAL_8250_RUNTIME_UARTS = freeform "3";
          SERIAL_CORE = yes;
          SERIAL_CORE_CONSOLE = yes;
          SERIAL_EARLYCON = yes;
          SHMEM = yes;
          SIGNALFD = yes;
          SLABINFO = yes;
          SLAB_MERGE_DEFAULT = yes;
          SLUB = yes;
          SLUB_CPU_PARTIAL = yes;
          SND_DRIVERS = yes;
          SND_HDA_POWER_SAVE_DEFAULT = lib.mkDefault (freeform "0");
          SND_HDA_PREALLOC_SIZE = freeform "64";
          SND_MAX_CARDS = freeform "16";
          SND_OSSEMUL = yes;
          SND_PCI = yes;
          SND_PCM_OSS_PLUGINS = yes;
          SND_PROC_FS = yes;
          SND_SOC_INTEL_SST_TOPLEVEL = yes;
          SND_USB = yes;
          SND_VERBOSE_PROCFS = yes;
          SND_X86 = yes;
          SPLIT_PTLOCK_CPUS = freeform "4";
          SQUASHFS = yes;
          SQUASHFS_DECOMP_MULTI_PERCPU = yes;
          SQUASHFS_EMBEDDED = yes;
          SQUASHFS_FILE_DIRECT = yes;
          SQUASHFS_FRAGMENT_CACHE_SIZE = freeform "3";
          SQUASHFS_XZ = yes;
          SSB_POSSIBLE = yes;
          STACKTRACE_SUPPORT = yes;
          STAGING = yes;
          STANDALONE = lib.mkForce yes;
          STDBINUTILS = yes;
          STP = yes;
          STRICT_KERNEL_RWX = yes;
          STRICT_MODULE_RWX = yes;
          STRIP_ASM_SYMS = yes;
          SUNRPC_DISABLE_INSECURE_ENCTYPES = yes;
          SWAP = yes;
          SYMBOLIC_ERRNAME = yes;
          SYN_COOKIES = yes;
          SYSCTL = yes;
          SYSFS = yes;
          # SYSTEM_TRUSTED_KEYS = freeform "";
          SYSVIPC = yes;
          SYSVIPC_SYSCTL = yes;
          TCP_CONG_ADVANCED = yes;
          TCP_CONG_CUBIC = yes;
          TEXTSEARCH = yes;
          THIN_ARCHIVES = yes;
          TICK_ONESHOT = yes;
          TIMERFD = yes;
          TINY_RCU = yes;
          TMPFS = yes;
          TMPFS_XATTR = yes;
          TRACE_IRQFLAGS_SUPPORT = yes;
          TRACING_SUPPORT = yes;
          TRAD_SIGNALS = yes;
          TTY = yes;
          UBIFS_FS_LZO = yes;
          UBIFS_FS_XATTR = yes;
          UBIFS_FS_ZLIB = yes;
          UBIFS_FS_ZSTD = yes;
          UBSAN_ALIGNMENT = yes;
          UEVENT_HELPER = lib.mkForce yes;
          UEVENT_HELPER_PATH = freeform "/sbin/hotplug";
          UID16 = yes;
          UNIX = yes;
          UNIX98_PTYS = yes;
          UNIX_SCM = yes;
          USBIP_VHCI_HC_PORTS = freeform "8";
          USBIP_VHCI_NR_HCS = freeform "1";
          USB_ALI_M5632 = yes;
          USB_AN2720 = yes;
          USB_ARCH_HAS_HCD = yes;
          USB_ARMLINUX = yes;
          USB_AUTOSUSPEND_DELAY = freeform "2";
          USB_BELKIN = yes;
          USB_DEFAULT_PERSIST = yes;
          USB_EHCI_ROOT_HUB_TT = yes;
          USB_EHCI_TT_NEWSCHED = yes;
          USB_GADGET_STORAGE_NUM_BUFFERS = freeform "2";
          USB_GADGET_VBUS_DRAW = freeform "2";
          USB_OHCI_LITTLE_ENDIAN = yes;
          USB_SERIAL_GENERIC = yes;
          USB_SERIAL_KEYSPAN_MPR = yes;
          USB_SERIAL_KEYSPAN_USA18X = yes;
          USB_SERIAL_KEYSPAN_USA19 = yes;
          USB_SERIAL_KEYSPAN_USA19QI = yes;
          USB_SERIAL_KEYSPAN_USA19QW = yes;
          USB_SERIAL_KEYSPAN_USA19W = yes;
          USB_SERIAL_KEYSPAN_USA28 = yes;
          USB_SERIAL_KEYSPAN_USA28X = yes;
          USB_SERIAL_KEYSPAN_USA28XA = yes;
          USB_SERIAL_KEYSPAN_USA28XB = yes;
          USB_SERIAL_KEYSPAN_USA49W = yes;
          USB_SERIAL_KEYSPAN_USA49WLC = yes;
          USB_SERIAL_SAFE_PADDED = yes;
          USB_VIDEO_CLASS_INPUT_EVDEV = yes;
          VDSO = yes;
          VHOST_MENU = yes;
          VIRTIO_MENU = yes;
          VIRT_TO_BUS = yes;
          VLAN_8021Q = yes;
          VMSPLIT_3G = yes;
          WATCHDOG = yes;
          WATCHDOG_HANDLE_BOOT_ENABLED = yes;
          WATCHDOG_OPEN_TIMEOUT = freeform "0";
          WEXT_CORE = yes;
          WEXT_PRIV = yes;
          WEXT_PROC = yes;
          WEXT_SPY = yes;
          WILINK_PLATFORM_DATA = yes;
          WIRELESS = yes;
          WIRELESS_EXT = yes;
          WLAN = yes;
          WQ_POWER_EFFICIENT_DEFAULT = yes;
          X86_SYSFB = yes;
          XEN_SCRUB_PAGES_DEFAULT = yes;
          XFRM = yes;
          XZ_DEC = yes;
          ZONE_DMA = yes;
          "64BIT" = yes;
          AQUANTIA_PHY = yes;
          ARCH_DMA_ADDR_T_64BIT = yes;
          ARCH_KEEP_MEMBLOCK = yes;
          ARCH_MEDIATEK = yes;
          ARCH_MHP_MEMMAP_ON_MEMORY_ENABLE = yes;
          ARCH_MMAP_RND_BITS = freeform "18";
          ARCH_MMAP_RND_BITS_MAX = freeform "24";
          ARCH_MMAP_RND_BITS_MIN = freeform "18";
          ARCH_MMAP_RND_COMPAT_BITS = freeform "11";
          ARCH_MMAP_RND_COMPAT_BITS_MIN = freeform "11";
          ARCH_MMAP_RND_COMPAT_BITS_MAX = freeform "16";
          ARCH_PROC_KCORE_TEXT = yes;
          ARCH_SPARSEMEM_ENABLE = yes;
          ARCH_STACKWALK = yes;
          ARCH_SUSPEND_POSSIBLE = yes;
          ARCH_WANTS_NO_INSTR = yes;
          ARM64 = yes;
          ARM64_4K_PAGES = yes;
          ARM64_CRYPTO = yes;
          ARM64_ERRATUM_843419 = yes;
          ARM64_ERRATUM_845719 = yes;
          ARM64_LD_HAS_FIX_ERRATUM_843419 = yes;
          ARM64_MODULE_PLTS = yes;
          ARM64_PAGE_SHIFT = freeform "12";
          ARM64_PA_BITS = freeform "48";
          ARM64_PA_BITS_48 = yes;
          ARM64_TAGGED_ADDR_ABI = yes;
          ARM64_VA_BITS = freeform "39";
          ARM64_VA_BITS_39 = yes;
          ARM_AMBA = yes;
          ARM_ARCH_TIMER = yes;
          ARM_ARCH_TIMER_EVTSTREAM = yes;
          ARM_GIC = yes;
          ARM_GIC_V2M = yes;
          ARM_GIC_V3 = yes;
          ARM_GIC_V3_ITS = yes;
          ARM_GIC_V3_ITS_PCI = yes;
          ARM_MEDIATEK_CPUFREQ = yes;
          ARM_PMU = yes;
          ARM_PSCI_FW = yes;
          ATA = yes;
          AUDIT_ARCH_COMPAT_GENERIC = yes;
          BLK_DEV_LOOP = yes;
          BLK_DEV_SD = yes;
          BLK_MQ_PCI = yes;
          BLK_PM = yes;
          BLOCK_COMPAT = yes;
          BSD_PROCESS_ACCT = yes;
          BSD_PROCESS_ACCT_V3 = yes;
          CC_HAVE_STACKPROTECTOR_SYSREG = yes;
          CLKSRC_MMIO = yes;
          CLONE_BACKWARDS = yes;
          COMMON_CLK = yes;
          COMMON_CLK_MEDIATEK = yes;
          COMMON_CLK_MT2712 = yes;
          COMMON_CLK_MT7622 = yes;
          COMMON_CLK_MT7622_AUDSYS = yes;
          COMMON_CLK_MT7622_ETHSYS = yes;
          COMMON_CLK_MT7622_HIFSYS = yes;
          COMMON_CLK_MT7986 = yes;
          COMMON_CLK_MT7986_ETHSYS = yes;
          COMMON_CLK_MT8183 = yes;
          COMMON_CLK_MT8516 = yes;
          COMPAT = yes;
          COMPAT_32BIT_TIME = yes;
          COMPAT_BINFMT_ELF = yes;
          COMPAT_NETLINK_MESSAGES = yes;
          COMPAT_OLD_SIGACTION = yes;
          CONFIGFS_FS = yes;
          CONSOLE_LOGLEVEL_DEFAULT = freeform "15";
          CPU_FREQ = yes;
          CPU_FREQ_DEFAULT_GOV_USERSPACE = yes;
          CPU_FREQ_GOV_ATTR_SET = yes;
          CPU_FREQ_GOV_COMMON = yes;
          CPU_FREQ_GOV_CONSERVATIVE = yes;
          CPU_FREQ_GOV_ONDEMAND = yes;
          CPU_FREQ_GOV_PERFORMANCE = yes;
          CPU_FREQ_GOV_POWERSAVE = yes;
          CPU_FREQ_GOV_SCHEDUTIL = yes;
          CPU_FREQ_GOV_USERSPACE = yes;
          CPU_FREQ_STAT = yes;
          CPU_RMAP = yes;
          CPU_THERMAL = yes;
          CRC16 = yes;
          CRYPTO_AES_ARM64 = yes;
          CRYPTO_AES_ARM64_CE = yes;
          CRYPTO_AES_ARM64_CE_BLK = yes;
          CRYPTO_AES_ARM64_CE_CCM = yes;
          CRYPTO_CMAC = yes;
          CRYPTO_CRC32 = yes;
          CRYPTO_CRC32C = yes;
          CRYPTO_CRYPTD = yes;
          CRYPTO_DEFLATE = yes;
          CRYPTO_DRBG = yes;
          CRYPTO_DRBG_HMAC = yes;
          CRYPTO_DRBG_MENU = yes;
          CRYPTO_ECB = yes;
          CRYPTO_ECC = yes;
          CRYPTO_ECDH = yes;
          CRYPTO_GHASH_ARM64_CE = yes;
          CRYPTO_HASH_INFO = yes;
          CRYPTO_HMAC = yes;
          CRYPTO_JITTERENTROPY = yes;
          CRYPTO_LIB_SHA256 = yes;
          CRYPTO_LZO = yes;
          CRYPTO_RNG = yes;
          CRYPTO_RNG2 = yes;
          CRYPTO_RNG_DEFAULT = yes;
          CRYPTO_SHA256 = yes;
          CRYPTO_SHA256_ARM64 = yes;
          CRYPTO_SHA2_ARM64_CE = yes;
          CRYPTO_SHA512 = yes;
          CRYPTO_SIMD = yes;
          CRYPTO_ZSTD = yes;
          DCACHE_WORD_ACCESS = yes;
          DEBUG_MISC = yes;
          DIMLIB = yes;
          DMADEVICES = yes;
          DMATEST = yes;
          DMA_DIRECT_REMAP = yes;
          DMA_ENGINE = yes;
          DMA_ENGINE_RAID = yes;
          DMA_OF = yes;
          DMA_REMAP = yes;
          DMA_VIRTUAL_CHANNELS = yes;
          DTC = yes;
          DYNAMIC_DEBUG = yes;
          EDAC_SUPPORT = yes;
          EINT_MTK = yes;
          EXT4_FS = yes;
          F2FS_FS = lib.mkForce yes;
          FIT_PARTITION = yes;
          FIXED_PHY = yes;
          FIX_EARLYCON_MEM = yes;
          FRAME_POINTER = yes;
          FS_IOMAP = yes;
          FS_MBCACHE = yes;
          FWNODE_MDIO = yes;
          FW_LOADER_PAGED_BUF = yes;
          GENERIC_ALLOCATOR = yes;
          GENERIC_ARCH_TOPOLOGY = yes;
          GENERIC_BUG = yes;
          GENERIC_BUG_RELATIVE_POINTERS = yes;
          GENERIC_CLOCKEVENTS = yes;
          GENERIC_CLOCKEVENTS_BROADCAST = yes;
          GENERIC_CPU_AUTOPROBE = yes;
          GENERIC_CPU_VULNERABILITIES = yes;
          GENERIC_CSUM = yes;
          GENERIC_EARLY_IOREMAP = yes;
          GENERIC_FIND_FIRST_BIT = yes;
          GENERIC_GETTIMEOFDAY = yes;
          GENERIC_IDLE_POLL_SETUP = yes;
          GENERIC_IRQ_EFFECTIVE_AFF_MASK = yes;
          GENERIC_IRQ_SHOW = yes;
          GENERIC_IRQ_SHOW_LEVEL = yes;
          GENERIC_LIB_DEVMEM_IS_ALLOWED = yes;
          GENERIC_MSI_IRQ = yes;
          GENERIC_MSI_IRQ_DOMAIN = yes;
          GENERIC_PCI_IOMAP = yes;
          GENERIC_PHY = yes;
          GENERIC_PINCONF = yes;
          GENERIC_PINCTRL_GROUPS = yes;
          GENERIC_PINMUX_FUNCTIONS = yes;
          GENERIC_SCHED_CLOCK = yes;
          GENERIC_SMP_IDLE_THREAD = yes;
          GENERIC_STRNCPY_FROM_USER = yes;
          GENERIC_STRNLEN_USER = yes;
          GENERIC_TIME_VSYSCALL = yes;
          GLOB = yes;
          GPIOLIB = yes;
          GPIO_CDEV = yes;
          GRO_CELLS = yes;
          HANDLE_DOMAIN_IRQ = yes;
          HARDIRQS_SW_RESEND = yes;
          HAS_DMA = yes;
          HAS_IOMEM = yes;
          HAS_IOPORT_MAP = yes;
          HW_RANDOM = yes;
          HW_RANDOM_MTK = yes;
          I2C = yes;
          I2C_BOARDINFO = yes;
          I2C_CHARDEV = yes;
          I2C_MT65XX = yes;
          ICPLUS_PHY = yes;
          IIO = yes;
          IKCONFIG = yes;
          IKPROC = yes;
          ILLEGAL_POINTER_VALUE = freeform "0xdead000000000000";
          # INITRAMFS_SOURCE = freeform "";
          IO_URING = yes;
          IRQCHIP = yes;
          IRQ_DOMAIN = yes;
          IRQ_DOMAIN_HIERARCHY = yes;
          IRQ_FORCED_THREADING = yes;
          IRQ_TIME_ACCOUNTING = yes;
          IRQ_WORK = yes;
          JBD2 = yes;
          JUMP_LABEL = yes;
          LIBFDT = yes;
          LOCK_DEBUGGING_SUPPORT = yes;
          LOCK_SPIN_ON_OWNER = yes;
          LZO_COMPRESS = yes;
          LZO_DECOMPRESS = yes;
          MAGIC_SYSRQ = yes;
          MAXLINEAR_GPHY = yes;
          MDIO_BUS = yes;
          MDIO_DEVICE = yes;
          MDIO_DEVRES = yes;
          MEDIATEK_GE_PHY = yes;
          #MEDIATEK_MT6577_AUXADC = yes;
          MEDIATEK_WATCHDOG = yes;
          MEMFD_CREATE = yes;
          MESSAGE_LOGLEVEL_DEFAULT = freeform "7";
          MFD_SYSCON = yes;
          MIGRATION = yes;
          MMC = yes;
          MMC_BLOCK = yes;
          MMC_CQHCI = yes;
          MMC_MTK = yes;
          MODULES_TREE_LOOKUP = yes;
          MODULES_USE_ELF_RELA = yes;
          MTD_NAND_CORE = yes;
          MTD_NAND_ECC = yes;
          MTD_NAND_ECC_MEDIATEK = yes;
          MTD_NAND_ECC_SW_HAMMING = yes;
          MTD_NAND_MTK = yes;
          MTD_NAND_MTK_BMT = yes;
          MTD_PARSER_TRX = yes;
          MTD_RAW_NAND = yes;
          MTD_SPI_NAND = yes;
          MTD_SPI_NOR = yes;
          MTD_SPLIT_FIRMWARE = yes;
          MTD_SPLIT_FIT_FW = yes;
          MTD_UBI = yes;
          MTD_UBI_BEB_LIMIT = freeform "20";
          MTD_UBI_BLOCK = yes;
          MTD_UBI_WL_THRESHOLD = freeform "4096";
          MTK_EFUSE = yes;
          MTK_HSDMA = yes;
          MTK_INFRACFG = yes;
          MTK_PMIC_WRAP = yes;
          MTK_SCPSYS = yes;
          MTK_SCPSYS_PM_DOMAINS = yes;
          MTK_THERMAL = yes;
          MTK_SOC_THERMAL = yes;
          MTK_TIMER = yes;
          MUTEX_SPIN_ON_OWNER = yes;
          NEED_DMA_MAP_STATE = yes;
          NEED_SG_DMA_LENGTH = yes;
          NET_DEVLINK = yes;
          NET_DSA = yes;
          NET_DSA_MT7530 = yes;
          NET_DSA_TAG_MTK = yes;
          NET_FLOW_LIMIT = yes;
          NET_MEDIATEK_SOC = yes;
          NET_MEDIATEK_SOC_WED = yes;
          NET_SELFTESTS = yes;
          NET_SWITCHDEV = yes;
          NET_VENDOR_MEDIATEK = yes;
          NLS = yes;
          NO_HZ_COMMON = yes;
          NO_HZ_IDLE = yes;
          NR_CPUS = lib.mkForce (freeform "4");
          NVMEM = yes;
          NVMEM_SYSFS = yes;
          OF = yes;
          OF_ADDRESS = yes;
          OF_DYNAMIC = yes;
          OF_EARLY_FLATTREE = yes;
          OF_FLATTREE = yes;
          OF_GPIO = yes;
          OF_IRQ = yes;
          OF_KOBJ = yes;
          OF_MDIO = yes;
          OF_OVERLAY = yes;
          OF_RESOLVE = yes;
          OLD_SIGSUSPEND3 = yes;
          PADATA = yes;
          PARTITION_PERCPU = yes;
          PCI = yes;
          PCIEAER = yes;
          PCIEASPM = yes;
          PCIEASPM_PERFORMANCE = yes;
          PCIEPORTBUS = yes;
          PCIE_MEDIATEK = yes;
          PCIE_MEDIATEK_GEN3 = yes;
          PCIE_PME = yes;
          PCI_DEBUG = yes;
          PCI_DOMAINS = yes;
          PCI_DOMAINS_GENERIC = yes;
          PCI_MSI = yes;
          PCI_MSI_IRQ_DOMAIN = yes;
          PERF_EVENTS = yes;
          PGTABLE_LEVELS = freeform "3";
          PHYLIB = yes;
          PHYLINK = yes;
          PHYS_ADDR_T_64BIT = yes;
          PHY_MTK_TPHY = yes;
          PINCTRL = yes;
          PINCTRL_MT7622 = yes;
          PINCTRL_MT7986 = yes;
          PINCTRL_MT8516 = yes;
          PINCTRL_MTK = yes;
          PINCTRL_MTK_MOORE = yes;
          PINCTRL_MTK_V2 = yes;
          PM = yes;
          PM_CLK = yes;
          PM_GENERIC_DOMAINS = yes;
          PM_GENERIC_DOMAINS_OF = yes;
          PM_OPP = yes;
          POWER_RESET = yes;
          POWER_RESET_SYSCON = yes;
          POWER_SUPPLY = yes;
          PRINTK_TIME = yes;
          PSTORE = yes;
          PSTORE_COMPRESS = no;
          #PSTORE_COMPRESS_DEFAULT = freeform "deflate";
          PSTORE_CONSOLE = yes;
          #PSTORE_DEFLATE_COMPRESS = yes;
          #PSTORE_DEFLATE_COMPRESS_DEFAULT = yes;
          PSTORE_PMSG = yes;
          PSTORE_RAM = yes;
          PTP_1588_CLOCK_OPTIONAL = yes;
          PWM = yes;
          PWM_MEDIATEK = yes;
          PWM_SYSFS = yes;
          QUEUED_RWLOCKS = yes;
          QUEUED_SPINLOCKS = yes;
          RAS = yes;
          RATIONAL = yes;
          REALTEK_PHY = yes;
          REED_SOLOMON = yes;
          REED_SOLOMON_DEC8 = yes;
          REED_SOLOMON_ENC8 = yes;
          REGMAP = yes;
          REGMAP_MMIO = yes;
          REGULATOR = yes;
          REGULATOR_FIXED_VOLTAGE = yes;
          REGULATOR_MT6380 = yes;
          RESET_CONTROLLER = yes;
          RFS_ACCEL = yes;
          RODATA_FULL_DEFAULT_ENABLED = yes;
          RPS = yes;
          RTC_CLASS = yes;
          RTC_DRV_MT7622 = yes;
          RTC_I2C_AND_SPI = yes;
          RTL8367S_GSW = yes;
          RWSEM_SPIN_ON_OWNER = yes;
          SCHED_MC = yes;
          SCSI = yes;
          SCSI_COMMON = yes;
          SERIAL_8250_FSL = yes;
          SERIAL_8250_MT6577 = yes;
          SERIAL_DEV_BUS = yes;
          SERIAL_DEV_CTRL_TTYPORT = yes;
          SERIAL_MCTRL_GPIO = yes;
          SERIAL_OF_PLATFORM = yes;
          SGL_ALLOC = yes;
          SG_POOL = yes;
          SMP = yes;
          SOCK_RX_QUEUE_MAPPING = yes;
          SPARSEMEM = yes;
          SPARSEMEM_EXTREME = yes;
          SPARSEMEM_VMEMMAP = yes;
          SPARSEMEM_VMEMMAP_ENABLE = yes;
          SPARSE_IRQ = yes;
          SPI = yes;
          SPI_DYNAMIC = yes;
          SPI_MASTER = yes;
          SPI_MEM = yes;
          SPI_MT65XX = yes;
          SPI_MTK_NOR = yes;
          SPI_MTK_SNFI = yes;
          SRCU = yes;
          SWCONFIG = yes;
          SWIOTLB = yes;
          SWPHY = yes;
          SYSCTL_EXCEPTION_TRACE = yes;
          SYSVIPC_COMPAT = yes;
          THERMAL = yes;
          THERMAL_DEFAULT_GOV_STEP_WISE = yes;
          THERMAL_EMERGENCY_POWEROFF_DELAY_MS = freeform "0";
          THERMAL_EMULATION = yes;
          THERMAL_GOV_BANG_BANG = yes;
          THERMAL_GOV_FAIR_SHARE = yes;
          THERMAL_GOV_STEP_WISE = yes;
          THERMAL_GOV_USER_SPACE = yes;
          THERMAL_OF = yes;
          THERMAL_WRITABLE_TRIPS = yes;
          THREAD_INFO_IN_TASK = yes;
          TICK_CPU_ACCOUNTING = yes;
          TIMER_OF = yes;
          TIMER_PROBE = yes;
          TREE_RCU = yes;
          TREE_SRCU = yes;
          UBIFS_FS = yes;
          USB = yes;
          USB_COMMON = yes;
          USB_SUPPORT = yes;
          USB_XHCI_HCD = yes;
          USB_XHCI_MTK = yes;
          VMAP_STACK = yes;
          WATCHDOG_CORE = yes;
          WATCHDOG_PRETIMEOUT_DEFAULT_GOV_PANIC = yes;
          WATCHDOG_PRETIMEOUT_GOV = yes;
          WATCHDOG_PRETIMEOUT_GOV_PANIC = yes;
          WATCHDOG_PRETIMEOUT_GOV_SEL = module;
          WATCHDOG_SYSFS = yes;
          XPS = yes;
          XXHASH = yes;
          ZLIB_DEFLATE = yes;
          ZLIB_INFLATE = yes;
          ZONE_DMA32 = yes;
          ZSTD_COMPRESS = yes;
          ZSTD_DECOMPRESS = yes;

          DEVTMPFS = yes;
          DEVTMPFS_MOUNT = yes;
          DEVTMPFS_SAFE = yes;

          WLAN_VENDOR_MEDIATEK = yes;
          CFG80211 = module;
          CFG80211_WEXT = yes;
          MAC80211 = module;
          MAC80211_LEDS = yes;
          MT7915E = module;
          MT798X_WMAC = yes;

          VFAT_FS = yes;
          NLS_CODEPAGE_437 = lib.mkForce yes;
          NLS_CODEPAGE_852 = yes;
          NLS_ISO8859_1 = lib.mkForce yes;
          NLS_ISO8859_15 = yes;

          USB_STORAGE = yes;
          I2C_GPIO = yes;
          SFP = yes;
          BLK_DEV_NVME = yes;
          NVME_HWMON = yes;

          USB_USBNET = module;
          USB_SERIAL = lib.mkForce module;
          USB_SERIAL_OPTION = module;
          USB_SERIAL_QUALCOMM = module;
          USB_NET_CDC_MBIM = module;
          USB_NET_QMI_WWAN = module;

          NVMEM_MTK_EFUSE = yes;
          SENSORS_PWM_FAN = yes;

          DUMMY = module;
          IP_PNP = lib.mkForce yes;
          IP_PNP_DHCP = yes;
          IP_PNP_BOOTP = yes;
          IP_PNP_RARP = yes;
          IPV6_ROUTER_PREF = yes;
          IPV6_OPTIMISTIC_DAD = yes;
          INET6_AH = module;
          INET6_ESP = module;
          INET6_IPCOMP = module;
          IPV6_MIP6 = module;
          IPV6_TUNNEL = module;
          IPV6_MULTIPLE_TABLES = yes;
          NETLINK_DIAG = yes;
          INET_UDP_DIAG = module;
          NET_IPIP = module;
          IP_MROUTE = yes;
          IP_PIMSM_V1 = yes;
          IP_PIMSM_V2 = yes;
          IPV6 = yes;
          NETFILTER = yes;
          NF_CONNTRACK = module;
          NF_CONNTRACK_IPV4 = module;
          NF_CONNTRACK_IPV6 = module;
          NETFILTER_NETLINK = module;
          NF_CT_NETLINK = module;
          IP_NF_IPTABLES = module;
          NF_LOG_IPV4 = module;
          NF_REJECT_IPV4 = module;
          IP6_NF_IPTABLES = module;
          NF_LOG_IPV6 = module;
          NF_REJECT_IPV6 = module;
          IP_NF_NAT = module;
          IP6_NF_NAT = module;
          IP_NF_FILTER = module;
          IP6_NF_FILTER = module;
          IP_NF_TARGET_MASQUERADE = module;
          IP6_NF_TARGET_MASQUERADE = module;
          IP_NF_MANGLE = module;
          IP6_NF_MANGLE = module;
          IP_NF_TARGET_REJECT = module;
          IP6_NF_TARGET_REJECT = module;
          IP6_NF_MATCH_RT = module;
          NETFILTER_SYNPROXY = module;
          IP_NF_TARGET_SYNPROXY = module;
          IP6_NF_TARGET_SYNPROXY = module;
          NETFILTER_XT_TARGET_CHECKSUM = module;
          NETFILTER_XT_MATCH_LIMIT = module;
          NETFILTER_XT_MATCH_STATE = module;
          NETFILTER_XT_TARGET_LOG = module;
          NETFILTER_XT_TARGET_TCPOPTSTRIP = module;
          NETFILTER_XT_MATCH_CONNTRACK = module;
          NETFILTER_XT_MATCH_MAC = module;
          NETFILTER_XT_MATCH_RECENT = module;
          NETFILTER_XT_MATCH_IPRANGE = module;
          NETFILTER_XT_MARK = module;
          NETFILTER_XT_CONNMARK = module;
          NETFILTER_XT_MATCH_ADDRTYPE = module;
          IP_VS = module;
          NETFILTER_XT_MATCH_IPVS = module;
          NETFILTER_XT_MATCH_CONNLIMIT = module;
          #NETFILTER_XT_TARGET_NFQUEUE= module;
          NF_TABLES = yes;
          NF_TABLES_SET = module;
          NF_TPROXY_IPV4 = module;
          NF_TPROXY_IPV6 = module;
          NFT_NUMGEN = module;
          NFT_CT = module;
          NFT_COUNTER = module;
          NFT_CONNLIMIT = module;
          NFT_LOG = module;
          NFT_LIMIT = module;
          NFT_MASQ = module;
          NFT_NAT = module;
          NFT_QUEUE = module;
          NFT_REDIR = module;
          NFT_TUNNEL = module;
          NFT_OBJREF = module;
          NFT_QUOTA = module;
          NFT_REJECT = module;
          NFT_COMPAT = module;
          NFT_HASH = module;
          NFT_XFRM = module;
          NFT_SOCKET = module;
          NFT_OSF = module;
          NFT_TPROXY = module;
          NFT_SYNPROXY = module;
          NFTL = module;
          NFTL_RW = yes;
          NFT_FIB_INET = module;
          NFT_FIB_IPV4 = module;
          NFT_FIB_IPV6 = module;
          NF_FLOW_TABLE = module;
          NF_FLOW_TABLE_INET = module;
          NF_FLOW_TABLE_IPV4 = module;
          NF_FLOW_TABLE_IPV6 = module;
          NFT_FLOW_OFFLOAD = module;
          NF_CONNTRACK_FTP = module;
          NF_NAT_FTP = module;
          PPP = module;
          PPPOE = module;
          PPP_DEFLATE = module;
          PPP_MPPE = module;
          VETH = module;
          TUN = module;
          VLAN_8021Q_GVRP = yes;
          VLAN_8021Q_MVRP = yes;
          NET_L3_MASTER_DEV = yes;
          IPVLAN = module;
          MACVLAN = module;
          NET_CLS_ACT = yes;
          # QoS and/or fair queueing
          NET_SCH_CBQ = module;
          NET_SCH_HTB = module;
          NET_SCH_CSZ = module;
          NET_SCH_PRIO = module;
          NET_SCH_RED = module;
          NET_SCH_SFQ = module;
          NET_SCH_TEQL = module;
          NET_SCH_TBF = module;
          NET_SCH_GRED = module;
          NET_SCH_DSMARK = module;
          NET_SCH_INGRESS = module;
          #NET_SCH_NETEM= module;
          NET_QOS = yes;
          NET_ESTIMATOR = yes;
          NET_CLS_TCINDEX = module;
          NET_CLS_ROUTE4 = module;
          NET_CLS_ROUTE = yes;
          NET_CLS_FW = module;
          NET_CLS_U32 = module;
          NET_CLS_RSVP = module;
          NET_CLS_RSVP6 = module;
          NET_CLS_POLICE = yes;

          NET_ACT_VLAN = module;
          NET_ACT_POLICE = module;
          NET_ACT_GACT = module;
          NET_ACT_MIRRED = module;
          NET_ACT_SAMPLE = yes;
          NET_ACT_IPT = module;
          NET_ACT_NAT = module;
          NET_ACT_PEDIT = module;
          NET_ACT_SIMP = module;
          NET_ACT_SKBEDIT = module;
          NET_ACT_CSUM = module;
          NET_ACT_CONNMARK = module;
          NET_ACT_CTINFO = module;
          NET_ACT_SKBMOD = module;
          NET_ACT_TUNNEL_KEY = module;
          NET_ACT_CT = module;

          #NFS Client
          NFS_FS = lib.mkForce yes;
          NFS_V2 = yes;
          NFS_V3_ACL = yes;
          NFS_V4 = yes;
          NFS_SWAP = yes;
          NFS_V4_1 = yes;
          NFS_V4_2 = yes;
          PNFS_FILE_LAYOUT = module;
          PNFS_BLOCK = module;
          PNFS_FLEXFILE_LAYOUT = module;
          NFS_V4_1_IMPLEMENTATION_ID_DOMAIN = freeform "kernel.org";
          NFS_V4_1_MIGRATION = yes;
          NFS_USE_LEGACY_DNS = yes;
          ROOT_NFS = yes;

          #NFS Server
          NFSD = module;
          NFSD_V2_ACL = yes;
          NFSD_V3_ACL = yes;
          NFSD_V4 = yes;
          NFSD_PNFS = yes;
          NFSD_BLOCKLAYOUT = yes;
          NFSD_SCSILAYOUT = yes;
          NFSD_FLEXFILELAYOUT = yes;
          NFSD_FAULT_INJECTION = yes;
          NFS_ACL_SUPPORT = module;

          #usb-tethering
          USB_NET_CDCETHER = module;
          USB_NET_CDC_EEM = module;
          USB_NET_RNDIS_HOST = module;

          #for lxc
          CGROUPS = yes;
          NAMESPACES = yes;
          USER_NS = yes;
          MEMCG = yes;
          CGROUP_CPUACCT = yes;
          CGROUP_DEVICE = yes;
          CGROUP_SCHED = yes;
          CPUSETS = yes;
          UNIX_DIAG = module;
          PACKET_DIAG = module;
          FUSE_FS = module;

          #for docker
          CGROUP_FREEZER = yes;
          MEMCG_SWAP = yes;
          MEMCG_SWAP_ENABLED = yes;
          BLK_CGROUP = yes;
          CFS_BANDWIDTH = yes;
          RT_GROUP_SCHED = lib.mkForce yes;
          CGROUP_PIDS = yes;
          CGROUP_PERF = yes;
          CGROUP_NET_CLASSID = yes;
          CGROUP_NET_PRIO = yes;
          CFQ_GROUP_IOSCHED = yes;
          POSIX_MQUEUE = yes;
          POSIX_MQUEUE_SYSCTL = yes;
          HAVE_ARCH_SECCOMP_FILTER = yes;
          SECCOMP_FILTER = yes;
          SECCOMP = yes;

          NET_IPGRE = module;
          NET_IPGRE_DEMUX = module;
        }
        // {
          ###################################
          # nixos-sbc config
          ###################################
          BTRFS_FS = module;
          BTRFS_FS_POSIX_ACL = yes;

          AUTOFS_FS = module;

          # Used by system.etc.overlay.enable as part of a perl-less build.
          EROFS_FS = module;
          EROFS_FS_ZIP_LZMA = yes;
          EROFS_FS_ZIP_DEFLATE = yes;
          EROFS_FS_ZIP_ZSTD = yes;
          EROFS_FS_PCPU_KTHREAD = yes;
        };
    }
  );
in
{
  boot.kernelPackages = lib.mkForce customKernel;
}
